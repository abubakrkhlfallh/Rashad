<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التاجر - رشّاد</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-seedling"></i>
                <span>رشّاد<span class="accent">.</span></span>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">س</div>
                <div>
                    <div class="user-name" id="userName">سالم للتجارة</div>
                    <div class="user-type" id="userType">تاجر</div>
                </div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="trader-dashboard.html" class="active"><i class="fas fa-home"></i> الرئيسية</a></li>
            <li><a href="#"><i class="fas fa-shopping-cart"></i> طلبات الشراء</a></li>
            <li><a href="#"><i class="fas fa-chart-line"></i> أسعار السوق</a></li>
            <li><a href="marketplace.html"><i class="fas fa-store"></i> السوق</a></li>
            <li><a href="#"><i class="fas fa-users"></i> الموردون</a></li>
            <li><a href="#"><i class="fas fa-truck"></i> التوصيل</a></li>
            <li><a href="#"><i class="fas fa-money-bill-wave"></i> المدفوعات</a></li>
            <li><a href="#"><i class="fas fa-warehouse"></i> المخزون</a></li>
            <li><a href="#"><i class="fas fa-file-contract"></i> العقود</a></li>
            <li><a href="#"><i class="fas fa-cog"></i> الإعدادات</a></li>
            <li><a href="index.html" onclick="logout()"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a></li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="page-title">
                <h1>لوحة تحكم التاجر</h1>
                <p id="welcomeMessage">إدارة مشترياتك من المحاصيل الزراعية</p>
            </div>
            
            <div class="top-bar-actions">
                <div class="notification-icon">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
                <button class="btn btn-primary" onclick="window.location.href='marketplace.html'">
                    <i class="fas fa-search"></i> استكشاف السوق
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="activeOrders">0</div>
                    <div class="stat-label">طلبات نشطة</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="monthlySpending">0</div>
                    <div class="stat-label">جنيه (مشتريات الشهر)</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalQuantity">0</div>
                    <div class="stat-label">طن (إجمالي الكميات)</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="growthRate">+0%</div>
                    <div class="stat-label">نمو في المشتريات</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Market Prices -->
            <div class="content-card wide">
                <div class="card-header">
                    <h2><i class="fas fa-chart-line"></i> أسعار السوق اليوم</h2>
                    <span class="text-muted">آخر تحديث: اليوم 10:00 صباحاً</span>
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>المحصول</th>
                                <th>السعر الحالي</th>
                                <th>التغير</th>
                                <th>أعلى سعر</th>
                                <th>أقل سعر</th>
                                <th>متوسط السوق</th>
                            </tr>
                        </thead>
                        <tbody id="marketPrices">
                            <tr>
                                <td colspan="6" class="text-center">جاري تحميل أسعار السوق...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Recent Orders -->
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-shopping-cart"></i> طلباتي الحديثة</h2>
                    <a href="#" class="btn btn-outline btn-sm">عرض الكل</a>
                </div>
                <div id="traderOrders" class="card-body">
                    <div class="loading">جاري تحميل الطلبات...</div>
                </div>
            </div>
            
            <!-- Recommended Suppliers -->
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-users"></i> موردون موصى بهم</h2>
                    <a href="#" class="btn btn-outline btn-sm">عرض الكل</a>
                </div>
                <div class="card-body">
                    <div class="suppliers-list">
                        <div class="supplier-item">
                            <div class="supplier-avatar">ع</div>
                            <div class="supplier-info">
                                <h4>عمر محمد</h4>
                                <p class="text-muted">مزارع قمح وذرة</p>
                                <div class="supplier-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span>4.7</span>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="viewSupplier('عمر محمد')">عرض المنتجات</button>
                            </div>
                        </div>
                        
                        <div class="supplier-item">
                            <div class="supplier-avatar">ح</div>
                            <div class="supplier-info">
                                <h4>حسن إبراهيم</h4>
                                <p class="text-muted">متخصص في الفول السوداني</p>
                                <div class="supplier-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span>5.0</span>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="viewSupplier('حسن إبراهيم')">عرض المنتجات</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="content-card">
                <div class="card-header">
                    <h2><i class="fas fa-bolt"></i> إجراءات سريعة</h2>
                </div>
                <div class="card-body">
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="window.location.href='marketplace.html'">
                            <i class="fas fa-search"></i>
                            <span>استكشاف السوق</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="quickBuy()">
                            <i class="fas fa-bolt"></i>
                            <span>شراء سريع</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="viewSuppliers()">
                            <i class="fas fa-users"></i>
                            <span>الموردون</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="viewAnalytics()">
                            <i class="fas fa-chart-line"></i>
                            <span>تحليل الأسعار</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="auth-manager.js"></script>
    <script src="script.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        // التحقق من المصادقة
        await window.authManager.checkAuthState();
        
        if (!window.authManager.isAuthenticated()) {
            window.location.href = 'login.html';
            return;
        }
        
        const user = window.authManager.getProfile();
        
        // التحقق من نوع المستخدم
        if (user.user_type !== 'trader') {
            window.location.href = 'index.html';
            return;
        }
        
        // تحديث معلومات المستخدم
        updateUserInfo(user);
        
        // تحميل بيانات لوحة التحكم
        await loadTraderDashboardData();
        
        // تحميل أسعار السوق
        await loadMarketPrices();
    });
    
    function updateUserInfo(user) {
        document.getElementById('userAvatar').textContent = user.first_name?.charAt(0) || 'ت';
        document.getElementById('userName').textContent = user.first_name || 'تاجر';
        document.getElementById('userType').textContent = 'تاجر';
        document.getElementById('welcomeMessage').textContent = `مرحباً ${user.first_name || 'تاجر'}!`;
    }
    
    async function loadMarketPrices() {
        // بيانات أسعار السوق الافتراضية
        const prices = [
            { crop: 'قمح', current: '1,500', change: '+2.5%', high: '1,550', low: '1,450', average: '1,500' },
            { crop: 'ذرة', current: '1,200', change: '-1.2%', high: '1,250', low: '1,150', average: '1,200' },
            { crop: 'فول سوداني', current: '2,000', change: '+3.8%', high: '2,100', low: '1,950', average: '2,000' },
            { crop: 'سمسم', current: '3,000', change: '0.0%', high: '3,050', low: '2,950', average: '3,000' },
            { crop: 'قطن', current: '4,500', change: '+1.5%', high: '4,600', low: '4,400', average: '4,500' }
        ];
        
        const tableBody = document.getElementById('marketPrices');
        tableBody.innerHTML = prices.map(price => `
            <tr>
                <td>${price.crop}</td>
                <td>${price.current} ج.س/طن</td>
                <td class="${price.change.includes('+') ? 'text-success' : price.change.includes('-') ? 'text-error' : ''}">
                    ${price.change}
                </td>
                <td>${price.high} ج.س</td>
                <td>${price.low} ج.س</td>
                <td>${price.average} ج.س</td>
            </tr>
        `).join('');
    }
    
    function quickBuy() {
        alert('ميزة الشراء السريع قيد التطوير. سيتم تفعيلها قريباً.');
    }
    
    function viewSuppliers() {
        alert('ميزة عرض الموردين قيد التطوير. سيتم تفعيلها قريباً.');
    }
    
    function viewAnalytics() {
        alert('ميزة تحليل الأسعار قيد التطوير. سيتم تفعيلها قريباً.');
    }
    
    function viewSupplier(supplierName) {
        alert(`عرض منتجات المورد: ${supplierName}\nفي النسخة الكاملة، سيتم عرض منتجات المورد.`);
    }
    
    function logout() {
        event.preventDefault();
        window.authManager.logout();
    }
    </script>
    <style>
    .suppliers-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .supplier-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        border-radius: var(--border-radius);
        background: var(--light-color);
    }
    
    .supplier-avatar {
        width: 50px;
        height: 50px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    
    .supplier-info {
        flex: 1;
    }
    
    .supplier-info h4 {
        margin-bottom: 0.25rem;
    }
    
    .supplier-rating {
        color: var(--accent-color);
        font-size: 0.875rem;
        margin: 0.25rem 0;
    }
    </style>
</body>
  </html>
